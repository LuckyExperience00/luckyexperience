<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lucky Experience</title>

<!-- PayPal -->
<script src="https://www.paypal.com/sdk/js?client-id=BAAN6bRif0SiRgIVogFIdoXGcyTo8yCOdtp86-1BFsjPk9efx1Hid7QRfndhe3Oyv24vh_BQcCnnk1fsIY&components=hosted-buttons&disable-funding=venmo&currency=EUR"></script>

<!-- QR Code -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qr-code-styling/1.5.0/qr-code-styling.min.js"></script>

<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
h1 { text-align: center; margin-bottom: 20px; }
#wheelCanvas { max-width: 90%; height: auto; }
#paypal-container { margin: 20px 0; }
#popup { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:1000; }
#popupContent { background: #fff; padding: 20px; border-radius: 10px; text-align:center; max-width: 90%; width: 400px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
#popupContent button { margin-top: 15px; padding: 10px 20px; border:none; background:#ff6600; color:white; border-radius:5px; cursor:pointer; font-size:16px; }
</style>
</head>
<body>

<h1>Gira la Ruota e Vinci!</h1>
<div id="paypal-container"></div>
<canvas id="wheelCanvas" width="500" height="500"></canvas>

<div id="popup">
  <div id="popupContent">
    <h2 id="prizeTitle"></h2>
    <p>Il tuo codice voucher:</p>
    <h3 id="voucherCode"></h3>
    <div id="qrCode" style="margin:15px auto;"></div>
    <button onclick="closePopup()">Chiudi</button>
  </div>
</div>

<script>
const prizes = [
  {percent: "20%", desc: "20% sconto 1 notte in SPA con Aperitivo"},
  {percent: "20%", desc: "20% sconto 1 notte in suite con Aperitivo"},
  {percent: "20%", desc: "20% sconto 1 notte in standard con Aperitivo"},
  {percent: "10%", desc: "10% sconto sosta 3h in qualsiasi tipo di camera"},
  {percent: "25%", desc: "25% sconto 1 notte in standard + 60 min percorso SPA"},
  {percent: "25%", desc: "25% sconto 1 notte in suite + 60 min SPA"}
];

let canvas = document.getElementById("wheelCanvas");
let ctx = canvas.getContext("2d");
let startAngle = 0;
let arc = 2 * Math.PI / prizes.length;
let spinning = false;

// Disegna la ruota con percentuali orizzontali
function drawWheel(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<prizes.length;i++){
    let angle = startAngle + i * arc;
    ctx.fillStyle = i % 2 === 0 ? "#ffcc66" : "#ff9966";
    ctx.beginPath();
    ctx.moveTo(250,250);
    ctx.arc(250,250,200,angle,angle+arc);
    ctx.fill();

    // Percentuale orizzontale
    let textAngle = angle + arc/2;
    let x = 250 + Math.cos(textAngle) * 120;
    let y = 250 + Math.sin(textAngle) * 120;
    ctx.fillStyle = "#000";
    ctx.font = "bold 18px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(prizes[i].percent, x, y);
  }
}

// Spin della ruota
function spinWheel(){
  if(spinning) return;
  spinning = true;
  let spinTime = 4000;
  let start = null;
  let totalRotation = Math.random()*4 + 4; // giri casuali

  function animate(timestamp){
    if(!start) start = timestamp;
    let progress = timestamp - start;
    let t = progress / spinTime;
    if(t>1) t=1;
    startAngle += totalRotation * 2 * Math.PI * (1 - Math.pow(1-t,3)); // easing cubic
    drawWheel();
    if(progress < spinTime){
      requestAnimationFrame(animate);
    } else {
      spinning = false;
      showPrize();
    }
  }
  requestAnimationFrame(animate);
}

// Mostra popup premio
function showPrize(){
  let index = Math.floor(prizes.length - (startAngle/(2*Math.PI) * prizes.length)) % prizes.length;
  if(index<0) index += prizes.length;
  let prize = prizes[index];
  let code = "LV-" + Math.floor(Math.random()*90000+10000) + "-" + Math.random().toString(36).substring(2,4).toUpperCase();

  document.getElementById("prizeTitle").textContent = prize.desc;
  document.getElementById("voucherCode").textContent = code;

  // QR code
  document.getElementById("qrCode").innerHTML = "";
  new QRCodeStyling({ width:150, height:150, data: code }).append(document.getElementById("qrCode"));

  document.getElementById("popup").style.display = "flex";
}

function closePopup(){
  document.getElementById("popup").style.display = "none";
}

// Disegna ruota iniziale
drawWheel();

// PayPal
paypal.HostedButtons({
  hostedButtonId: "EVWS5RHG3HSQS",
  onApprove: function(data, actions){
    spinWheel();
  }
}).render("#paypal-container");
</script>

</body>
</html>
