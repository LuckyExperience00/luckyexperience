<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LuckyExperience ‚Äì Gira la Ruota</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at center, #111, #000);
      color: #fff;
      text-align: center;
      padding: 30px;
    }
    h1 {
      color: #FFD700;
      font-size: 30px;
      margin-bottom: 8px;
    }
    p {
      color: #bbb;
      margin-bottom: 20px;
      line-height: 1.5;
    }
    #paypal-container { margin: 26px auto; }
    #spin-button {
      display: none;
      background: linear-gradient(90deg, #FFD700, #FF8C00);
      color: #000;
      border: none;
      border-radius: 12px;
      padding: 14px 26px;
      font-size: 18px;
      cursor: pointer;
      margin-top: 16px;
      font-weight: 700;
      transition: transform .2s, box-shadow .2s;
      box-shadow: 0 0 14px #ffb40099;
    }
    #spin-button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 18px #ffb400cc;
    }
    #spin-button:disabled { opacity: .6; cursor: not-allowed; }
    canvas {
      width: 360px;
      height: 360px;
      border-radius: 50%;
      margin-top: 18px;
      box-shadow: 0 0 25px #ffd70055;
      background: radial-gradient(circle at 50% 50%, #333, #111);
    }
    .legal {
      margin-top: 40px;
      font-size: 12px;
      color: #aaa;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }
    a { color: #FFD700; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>

  <!-- SDK PayPal + Hosted Buttons -->
  <script src="https://www.paypal.com/sdk/js?client-id=BAAN6bRif0SiRgIVogFIdoXGcyTo8yCOdtp86-1BFsjPk9efx1Hid7QRfndhe3Oyv24vh_BQcCnnk1fsIY&components=hosted-buttons&disable-funding=venmo&currency=EUR"></script>
</head>

<body>
  <img src="https://cdn.shopify.com/s/files/1/0972/5398/2543/files/logo_ritagliato.png?v=1761577845" alt="LuckyExperience" style="width:120px;margin-bottom:15px;">
  <h1>üé° LuckyExperience</h1>
  <p>Effettua il pagamento e gira la ruota una sola volta per scoprire la tua esperienza esclusiva!</p>

  <!-- Frase legale di accettazione -->
  <p style="font-size:13px;color:#FFD700;max-width:520px;margin:0 auto 12px;">
    Effettuando il pagamento dichiari di aver letto e accettato i 
    <a href="LuckyExperience_Politiche_Utilizzo_Reclami.pdf" target="_blank" style="color:#FFD700;">
      Termini e politiche LuckyExperience
    </a>.
  </p>

  <div id="paypal-container"></div>
  <button id="spin-button">üéØ Gira la Ruota!</button>
  <canvas id="wheelCanvas" width="400" height="400"></canvas>

  <div class="legal">
    <p><strong>Nota premi ‚ÄúPremium‚Äù (SPA/Jacuzzi):</strong> i premi che includono SPA o Jacuzzi sono riscattabili presso le strutture partner dotate di tali servizi (indicate nell‚Äôelenco partner con i simboli üßñ‚Äç‚ôÄÔ∏è/üõÅ). Se scegli una struttura che non offre quel servizio, il premio verr√† convertito in uno <strong>sconto equivalente sul pernottamento</strong>. Gli sconti ‚ÄúSosta‚Äù sono convertibili al <strong>50%</strong> come sconto notte nelle strutture che non offrono la sosta.</p>
    <p><strong>LuckyExperience</strong> √® un servizio indipendente proposto in collaborazione con strutture partner. Ogni partecipante ottiene sempre un premio garantito; non √® gioco d‚Äôazzardo (D.P.R. 430/2001).</p>
    <p>üìß <a href="mailto:luckyexperienceinfoexperience@gmail.com">luckyexperienceinfoexperience@gmail.com</a></p>
    <p>LuckyExperience ¬© 2025 ‚Äì Tutti i diritti riservati ‚Ä¢ <a href="LuckyExperience_Politiche_Utilizzo_Reclami.pdf" target="_blank">üìÑ Termini e politiche</a></p>
  </div>

  <script>
    // === CONFIG ===
    const HOSTED_BUTTON_ID = "EVWS5RHG3HSQS";
    const RETURN_URL = "https://luckyexperience00.github.io/luckyexperience/?paid=1";

    // === NUOVI PREMI (universali + premium) ===
    // NB: le chance sono pesi relativi; somma libera.
    const prizes = [
      { label:"45% Notte", desc:"45% di sconto su 1 pernottamento", chance: 2 },
      { label:"40% Notte", desc:"40% di sconto su 1 pernottamento", chance: 3 },
      { label:"35% Notte", desc:"35% di sconto su 1 pernottamento", chance: 5 },
      { label:"30% Notte", desc:"30% di sconto su 1 pernottamento", chance: 7 },
      { label:"25% Notte", desc:"25% di sconto su 1 pernottamento", chance: 9 },
      { label:"20% Notte", desc:"20% di sconto su 1 pernottamento", chance: 11 },
      { label:"15% Notte", desc:"15% di sconto su 1 pernottamento", chance: 13 },
      { label:"10% Notte", desc:"10% di sconto su 1 pernottamento", chance: 15 },
      { label:"20% Sosta", desc:"20% di sconto su una sosta 3h (o 10% notte se la sosta non √® disponibile)", chance: 8 },
      { label:"15% Sosta", desc:"15% di sconto su una sosta 3h (o 7.5% notte se la sosta non √® disponibile)", chance: 9 },
      { label:"10% Sosta", desc:"10% di sconto su una sosta 3h (o 5% notte se la sosta non √® disponibile)", chance: 9 },
      { label:"SPA60",     desc:"Percorso SPA di 60 minuti (riscattabile solo in strutture con üßñ‚Äç‚ôÄÔ∏è)", chance: 3 },
      { label:"Jacuzzi",   desc:"Upgrade gratuito in camera con Jacuzzi (riscattabile solo in strutture con üõÅ)", chance: 2 }
    ];

    const colors = ["#FFD700","#FFB400","#FFA500","#FF8C00","#FFAE42","#FFC125","#FFB84D","#FFC966","#FF9F1C","#FFC04D","#FFB266","#FFA64D"];

    // === CANVAS RUOTA ===
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spin-button");
    const N = prizes.length;
    const ARC = (2 * Math.PI) / N;

    let currentRotation = 0;

    function drawWheel(rotation = 0) {
      const cx = canvas.width / 2;
      const cy = canvas.height / 2;
      const r  = canvas.width / 2;

      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(rotation);

      for (let i=0; i<N; i++) {
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.arc(0,0,r, i*ARC, (i+1)*ARC);
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();

        ctx.save();
        ctx.rotate(i*ARC + ARC/2);
        ctx.fillStyle = "#000";
        ctx.font = "bold 14px Poppins";
        ctx.textAlign = "right";
        ctx.fillText(prizes[i].label, r - 12, 6);
        ctx.restore();
      }
      ctx.restore();

      // puntatore
      ctx.fillStyle = "#fff";
      ctx.beginPath();
      const px = canvas.width/2;
      ctx.moveTo(px - 10, 12);
      ctx.lineTo(px + 10, 12);
      ctx.lineTo(px, 30);
      ctx.closePath();
      ctx.fill();
    }

    drawWheel(currentRotation);

    function weightedPick(items) {
      const total = items.reduce((s, it) => s + it.chance, 0);
      let r = Math.random() * total;
      for (let i=0; i<items.length; i++) {
        if (r < items[i].chance) return i;
        r -= items[i].chance;
      }
      return items.length - 1;
    }

    function computeTargetRotation(targetIndex) {
      const base = -Math.PI/2 - (targetIndex * ARC + ARC/2);
      const turns = 6 + Math.floor(Math.random()*3);
      return base + turns * 2 * Math.PI;
    }

    let isSpinning = false;

    function spinWheel() {
      if (isSpinning) return;
      isSpinning = true;
      spinBtn.disabled = true;

      const winnerIndex = weightedPick(prizes);
      const targetRotation = computeTargetRotation(winnerIndex);
      const duration = 4800;
      const start = performance.now();
      const startRot = currentRotation;

      function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

      function frame(now) {
        let t = (now - start) / duration;
        if (t > 1) t = 1;
        const rot = startRot + (targetRotation - startRot) * easeOutCubic(t);
        drawWheel(rot);
        if (t < 1) {
          requestAnimationFrame(frame);
        } else {
          currentRotation = targetRotation % (2*Math.PI);
          isSpinning = false;

          const prize = prizes[winnerIndex];
          const code = "LX-" + Math.random().toString(36).substring(2, 8).toUpperCase();
          const encodedDesc = encodeURIComponent(prize.desc);
          const encodedCode = encodeURIComponent(code);
          window.location.href = `voucher.html?desc=${encodedDesc}&code=${encodedCode}`;
        }
      }
      requestAnimationFrame(frame);
    }

    // === PAYPAL ===
    paypal.HostedButtons({
      hostedButtonId: HOSTED_BUTTON_ID,
      onApprove: function () {
        localStorage.setItem("paid_flag", "true");
        alert("‚úÖ Pagamento completato! Ora puoi girare la ruota.");
        document.getElementById("spin-button").style.display = "inline-block";
      }
    }).render("#paypal-container");

    // Sblocco dopo redirect
    document.addEventListener("DOMContentLoaded", function(){
      const params = new URLSearchParams(window.location.search);
      if (params.get("paid") === "1" || localStorage.getItem("paid_flag") === "true") {
        document.getElementById("spin-button").style.display = "inline-block";
        localStorage.removeItem("paid_flag");
      }
    });

    document.getElementById("spin-button").addEventListener("click", spinWheel);
  </script>
</body>
</html>


