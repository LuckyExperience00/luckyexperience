// Percentuali da mostrare sulla ruota
const prizesPercent = ["20%","20%","20%","10%","25%","25%"];

// Premi completi da mostrare dopo lo spin
const prizesFull = [
  "20% sconto 1 notte in SPA con Aperitivo",
  "20% sconto 1 notte in suite con aperitivo",
  "20% sconto 1 notte in standard con aperitivo",
  "10% sconto sosta 3 h in qualsiasi tipo di camera",
  "25% sconto 1 notte in standard + 60 min percorso SPA",
  "25% sconto 1 notte in suite + 60 min SPA"
];

// Modifica drawWheelBase:
function drawWheelBase(rotation=0) {
  const num = prizesPercent.length;
  const cx = canvas.width/2, cy = canvas.height/2, r = canvas.width/2;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const arc = 2*Math.PI/num;
  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(rotation);
  for(let i=0;i<num;i++){
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,r,i*arc,(i+1)*arc);
    ctx.fillStyle = colors[i%colors.length];
    ctx.fill();
    ctx.save();
    ctx.rotate(i*arc + arc/2);
    ctx.fillStyle="#111";
    ctx.textAlign="right";
    ctx.font = "16px Arial";
    ctx.fillText(prizesPercent[i], r-10, 6); // <-- Solo percentuale
    ctx.restore();
  }
  ctx.restore();
  ctx.fillStyle = "#222";
  ctx.beginPath();
  ctx.moveTo(cx-10, 10);
  ctx.lineTo(cx+10, 10);
  ctx.lineTo(cx, 28);
  ctx.fill();
}

// Modifica spinWheel, alert finale:
function spinWheel(){
  if(isSpinning) return;
  if(localStorage.getItem("girata")==="true"){
    alert("Hai giÃ  utilizzato il tuo giro.");
    return;
  }
  isSpinning = true;
  spinBtn.disabled = true;

  const totalDeg = Math.random()*360 + 1080;
  const duration = 4500;
  const start = performance.now();

  function frame(now){
    let t = (now - start)/duration;
    if(t>1) t=1;
    const ease = 1 - Math.pow(1 - t, 3);
    const deg = ease * totalDeg;
    const rad = deg * Math.PI/180;
    drawWheelBase(rad);
    if(t < 1) requestAnimationFrame(frame);
    else {
      isSpinning = false;
      localStorage.setItem("girata","true");
      overlay.style.display = "block";
      const landed = (360 - (totalDeg % 360)) % 360;
      const slice = 360 / prizesFull.length;
      let index = Math.floor(landed / slice);
      const winner = prizesFull[(prizesFull.length - 1 - index + prizesFull.length) % prizesFull.length];
      setTimeout(() => alert("Hai vinto: " + winner), 200);
    }
  }
  requestAnimationFrame(frame);
}
