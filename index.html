<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lucky Experience - Ruota della Fortuna</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #f4f4f4;
      text-align: center;
      margin: 0;
      padding: 40px;
    }
    .card {
      background: #fff;
      display: inline-block;
      padding: 25px 40px;
      border-radius: 16px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #333;
      font-size: 26px;
      margin-bottom: 8px;
    }
    p {
      color: #666;
      font-size: 15px;
      margin-bottom: 25px;
    }
    #paypal-container {
      margin-bottom: 20px;
    }
    #spin-button {
      display: none;
      background: #0070ba;
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #spin-button:hover {
      background: #005c99;
    }
    #wheel-wrap {
      position: relative;
      margin: 20px auto;
      width: 340px;
      height: 340px;
    }
    canvas {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    #overlay {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: rgba(255,255,255,0.7);
    }
  </style>
  <script src="https://www.paypal.com/sdk/js?client-id=BAAN6bRif0SiRgIVogFIdoXGcyTo8yCOdtp86-1BFsjPk9efx1Hid7QRfndhe3Oyv24vh_BQcCnnk1fsIY&components=hosted-buttons&currency=EUR"></script>
</head>
<body>
  <div class="card">
    <h1>ðŸŽ¯ Lucky Experience</h1>
    <p>Effettua il pagamento e ottieni 1 giro della ruota per scoprire il tuo sconto!</p>

    <div id="paypal-container"></div>
    <button id="spin-button">ðŸŽ¡ Gira la Ruota</button>

    <div id="wheel-wrap">
      <canvas id="wheelCanvas" width="500" height="500"></canvas>
      <div id="overlay"></div>
    </div>
  </div>

<script>
const HOSTED_BUTTON_ID = "EVWS5RHG3HSQS";
const RETURN_URL = "https://davidflow00.github.io/luckyexperience/?paid=1";

// Premi e sconti
const discounts = ["10%", "20%", "25%", "30%", "40%", "50%"];
const fullPrizes = [
  "20% sconto 1 notte in SPA con Aperitivo",
  "20% sconto 1 notte in suite con aperitivo",
  "20% sconto 1 notte in standard con aperitivo",
  "10% sconto sosta 3 h in qualsiasi tipo di camera",
  "25% sconto 1 notte in standard + 60 min percorso SPA",
  "25% sconto 1 notte in suite + 60 min SPA"
];
const colors = ["#FFD54F","#FFB74D","#4FC3F7","#81C784","#BA68C8","#E57373"];

const canvas = document.getElementById("wheelCanvas");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spin-button");
const overlay = document.getElementById("overlay");

// Disegno ruota
function drawWheel(rotation=0) {
  const num = discounts.length;
  const cx = canvas.width / 2, cy = canvas.height / 2, r = canvas.width / 2;
  const arc = 2 * Math.PI / num;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(rotation);
  for(let i=0;i<num;i++){
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,r,i*arc,(i+1)*arc);
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    ctx.save();
    ctx.rotate(i*arc + arc/2);
    ctx.fillStyle = "#222";
    ctx.font = "bold 22px Arial";
    ctx.textAlign = "right";
    ctx.fillText(discounts[i], r - 20, 10);
    ctx.restore();
  }
  ctx.restore();
  ctx.fillStyle = "#222";
  ctx.beginPath();
  ctx.moveTo(cx-10, 10);
  ctx.lineTo(cx+10, 10);
  ctx.lineTo(cx, 28);
  ctx.fill();
}
drawWheel();

let spinning = false;
function spinWheel(){
  if(spinning) return;
  if(localStorage.getItem("used_spin")==="true"){
    alert("Hai giÃ  usato il tuo giro!");
    return;
  }
  spinning = true;
  spinBtn.disabled = true;
  const totalDeg = 1440 + Math.random()*360;
  const duration = 4000;
  const start = performance.now();

  function frame(now){
    let t = (now - start)/duration;
    if(t>1) t=1;
    const ease = 1 - Math.pow(1-t,3);
    const deg = ease * totalDeg;
    const rad = deg * Math.PI / 180;
    drawWheel(rad);
    if(t<1) requestAnimationFrame(frame);
    else {
      spinning = false;
      localStorage.setItem("used_spin","true");
      const landed = (360 - (totalDeg % 360)) % 360;
      const slice = 360 / discounts.length;
      const index = Math.floor(landed / slice);
      const discount = discounts[(discounts.length - 1 - index + discounts.length) % discounts.length];
      const prize = fullPrizes[index % fullPrizes.length];
      alert(`ðŸŽ‰ Hai vinto: ${discount} - ${prize}`);
    }
  }
  requestAnimationFrame(frame);
}

function enableSpin(){
  if(localStorage.getItem("used_spin")==="true"){
    overlay.style.display="block";
    return;
  }
  spinBtn.style.display="inline-block";
  spinBtn.disabled=false;
}

paypal.HostedButtons({
  hostedButtonId: HOSTED_BUTTON_ID,
  onApprove: function(data, actions){
    localStorage.setItem("paid_flag","true");
    enableSpin();
    alert("âœ… Pagamento confermato! Ora puoi girare la ruota.");
  }
}).render("#paypal-container");

document.addEventListener("DOMContentLoaded", ()=>{
  const params = new URLSearchParams(window.location.search);
  if(params.get("paid")==="1" || localStorage.getItem("paid_flag")==="true"){
    enableSpin();
  }
});
spinBtn.addEventListener("click", spinWheel);
</script>
</body>
</html>
