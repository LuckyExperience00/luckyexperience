<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lucky Experience - Ruota della Fortuna</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=BAAN6bRif0SiRgIVogFIdoXGcyTo8yCOdtp86-1BFsjPk9efx1Hid7QRfndhe3Oyv24vh_BQcCnnk1fsIY&components=hosted-buttons&disable-funding=venmo&currency=EUR"></script>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: linear-gradient(180deg, #ffffff, #f2f2f2);
      margin: 0;
      padding: 0;
    }
    h1 {
      color: #222;
      margin-top: 40px;
      font-size: 28px;
    }
    #paypal-container {
      margin: 25px auto;
      width: fit-content;
    }
    canvas {
      margin-top: 20px;
      max-width: 400px;
      width: 90%;
    }
    #overlay {
      display:none;
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      background: rgba(255,255,255,0.7);
      z-index: 10;
    }
    footer {
      margin-top: 30px;
      color: #777;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <h1>üéØ Lucky Experience - Gira la Ruota della Fortuna!</h1>

  <div id="paypal-container"></div>

  <div style="position:relative; display:inline-block;">
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
    <div id="overlay"></div>
  </div>

  <footer>Buona fortuna! üçÄ</footer>

  <script>
    // Premi disponibili
    const prizes = ["Sconto 5‚Ç¨", "Prova di nuovo", "Sconto 10‚Ç¨", "Nessuna vincita", "Sorpresa!", "Sconto 15‚Ç¨"];
    const colors = ["#FFCDD2","#F8BBD0","#E1BEE7","#C5CAE9","#BBDEFB","#B2DFDB"];
    let spinning = false;

    // Disegna la ruota
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");

    function drawWheel() {
      const num = prizes.length;
      const arc = 2 * Math.PI / num;
      for (let i = 0; i < num; i++) {
        ctx.beginPath();
        ctx.moveTo(200,200);
        ctx.arc(200,200,200, i*arc, (i+1)*arc);
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();
        ctx.save();
        ctx.translate(200,200);
        ctx.rotate((i+0.5)*arc);
        ctx.textAlign = "right";
        ctx.fillStyle = "#000";
        ctx.font = "16px Arial";
        ctx.fillText(prizes[i],180,5);
        ctx.restore();
      }
    }
    drawWheel();

    // Gira la ruota
    function spinWheel() {
      if (spinning || localStorage.getItem("girata") === "true") {
        alert("Hai gi√† girato la ruota!");
        return;
      }
      spinning = true;
      let spin = Math.random() * 360 + 1080; // minimo 3 giri
      const dur = 4000;
      const start = performance.now();

      function animate(time) {
        let t = (time - start) / dur;
        if (t > 1) t = 1;
        let ease = 1 - Math.pow(1 - t, 3);
        let angle = ease * spin;
        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.clearRect(0, 0, 400, 400);
        ctx.save();
        ctx.translate(200, 200);
        ctx.rotate(angle * Math.PI / 180);
        ctx.translate(-200, -200);
        drawWheel();
        ctx.restore();

        if (t < 1) requestAnimationFrame(animate);
        else {
          spinning = false;
          localStorage.setItem("girata", "true");
          document.getElementById("overlay").style.display = "block";
          const idx = Math.floor(((spin % 360) / (360 / prizes.length)));
          alert("Hai vinto: " + prizes[prizes.length - 1 - idx]);
        }
      }
      requestAnimationFrame(animate);
    }

    // Pulsante PayPal
    paypal.HostedButtons({
      hostedButtonId: "EVWS5RHG3HSQS",
      onApprove: function(data, actions) {
        alert("Pagamento completato! Ora puoi girare la ruota üéâ");
        spinWheel();
      }
    }).render("#paypal-container");
  </script>
</body>
</html>
